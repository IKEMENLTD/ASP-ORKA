# ‰∏çÊ≠£Ê§úÁü•„Ç∑„Çπ„ÉÜ„É† Ë©≥Á¥∞Ë®≠Ë®àÊõ∏

## üìã ÁõÆÊ¨°
1. [‰∏çÊ≠£„Éë„Çø„Éº„É≥ÂàÜÈ°û](#‰∏çÊ≠£„Éë„Çø„Éº„É≥ÂàÜÈ°û)
2. [Ê§úÁü•„Ç¢„É´„Ç¥„É™„Ç∫„É†](#Ê§úÁü•„Ç¢„É´„Ç¥„É™„Ç∫„É†)
3. [Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´](#Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´)
4. [ÂÆüË£Ö„Ç≥„Éº„Éâ‰æã](#ÂÆüË£Ö„Ç≥„Éº„Éâ‰æã)
5. [ÈÅãÁî®„É´„Éº„É´](#ÈÅãÁî®„É´„Éº„É´)

---

## üéØ ‰∏çÊ≠£„Éë„Çø„Éº„É≥ÂàÜÈ°û

### 1. „ÇØ„É™„ÉÉ„ÇØ‰∏çÊ≠£

#### 1-1. „ÇØ„É™„ÉÉ„ÇØ„Çπ„Éë„É†ÔºàClick SpamÔºâ
**ÁâπÂæ¥:**
- Áü≠ÊôÇÈñì„Å´Âêå‰∏ÄIP„Åã„ÇâÂ§ßÈáè„ÇØ„É™„ÉÉ„ÇØ
- „Éú„ÉÉ„Éà„Å´„Çà„ÇãËá™Âãï„ÇØ„É™„ÉÉ„ÇØ
- „ÇØ„É™„ÉÉ„ÇØ„Éï„Ç°„Éº„É†

**Ê§úÁü•ÊåáÊ®ô:**
```
- Âêå‰∏ÄIP: 1ÊôÇÈñì„Å´10„ÇØ„É™„ÉÉ„ÇØ‰ª•‰∏ä
- Âêå‰∏Ä„Éá„Éê„Ç§„ÇπFP: 1ÊôÇÈñì„Å´15„ÇØ„É™„ÉÉ„ÇØ‰ª•‰∏ä
- „ÇØ„É™„ÉÉ„ÇØÈñìÈöî: Âπ≥Âùá5Áßí‰ª•‰∏ã
- „Éú„ÉÉ„ÉàUAÁéá: 80%‰ª•‰∏ä
```

#### 1-2. „ÇØ„É™„ÉÉ„ÇØ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÔºàClick InjectionÔºâ
**ÁâπÂæ¥:**
- „Ç¢„Éó„É™„Ç§„É≥„Çπ„Éà„Éº„É´Áõ¥Ââç„ÅÆ‰∏çÊ≠£„ÇØ„É™„ÉÉ„ÇØ
- Êú¨Êù•„ÅÆ„Ç¢„Éà„É™„Éì„É•„Éº„Ç∑„Éß„É≥„ÇíÊ®™Âèñ„Çä

**Ê§úÁü•ÊåáÊ®ô:**
```
- „ÇØ„É™„ÉÉ„ÇØ‚Üí„Ç§„É≥„Çπ„Éà„Éº„É´: 5Áßí‰ª•ÂÜÖ
- „Ç§„É≥„Çπ„Éà„Éº„É´Áõ¥Ââç„ÅÆÁï∞Â∏∏„ÇØ„É™„ÉÉ„ÇØÊÄ•Â¢ó
```

#### 1-3. Cookie„Çπ„Çø„ÉÉ„Éï„Ç£„É≥„Ç∞ÔºàCookie StuffingÔºâ
**ÁâπÂæ¥:**
- „É¶„Éº„Ç∂„Éº„ÅÆÁü•„Çâ„Å™„ÅÑ„ÅÜ„Å°„Å´„Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàCookie„ÇíË®≠ÂÆö
- iframe„ÇÑËá™Âãï„É™„ÉÄ„Ç§„É¨„ÇØ„Éà„ÅßÂÆüÊñΩ

**Ê§úÁü•ÊåáÊ®ô:**
```
- Cookie„Çª„ÉÉ„ÉàÊôÇ„ÅÆ„É¶„Éº„Ç∂„ÉºÊªûÂú®ÊôÇÈñì: 0Áßí
- Referer‰∏ç‰∏ÄËá¥
- JavaScriptÁÑ°ÂäπÁí∞Â¢É„Åã„Çâ„ÅÆCookie
```

---

### 2. „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥‰∏çÊ≠£

#### 2-1. „Çª„É´„Éï„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Éà
**ÁâπÂæ¥:**
- „Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„ÉºËá™Ë∫´„ÅåË≥ºÂÖ•
- Âêå‰∏ÄIP„Åã„Çâ„ÇØ„É™„ÉÉ„ÇØ‚ÜíË≥ºÂÖ•

**Ê§úÁü•ÊåáÊ®ô:**
```
- „Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàID„Å®Ë≥ºÂÖ•ËÄÖÊÉÖÂ†±„ÅÆ‰∏ÄËá¥
- „ÇØ„É™„ÉÉ„ÇØIP„Å®Ë≥ºÂÖ•IP„ÅÆÂÆåÂÖ®‰∏ÄËá¥
- Âêå‰∏Ä„Éá„Éê„Ç§„Çπ„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„Éà
```

#### 2-2. ËøîÈáëË©êÊ¨∫
**ÁâπÂæ¥:**
- „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥ÊâøË™çÂæå„Å´Âç≥ËøîÈáë
- È´òÈ†ªÂ∫¶„ÅÆËøîÈáë„É™„ÇØ„Ç®„Çπ„Éà

**Ê§úÁü•ÊåáÊ®ô:**
```
- ËøîÈáëÁéá: 30%‰ª•‰∏ä
- „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥‚ÜíËøîÈáë: 7Êó•‰ª•ÂÜÖ
- Âêå‰∏Ä„É¶„Éº„Ç∂„Éº„ÅÆËøîÈáëÂõûÊï∞: 3Âõû‰ª•‰∏ä/Êúà
```

#### 2-3. Êû∂Á©∫Ê≥®Êñá
**ÁâπÂæ¥:**
- Â≠òÂú®„Åó„Å™„ÅÑÊ≥®Êñá„ÅÆÂ†±Âëä
- ÂÅΩË£Ö„Åï„Çå„Åü„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥„Éá„Éº„Çø

**Ê§úÁü•ÊåáÊ®ô:**
```
- Ê≥®ÊñáID„ÅÆÈáçË§á
- ECÂÅ¥„ÅÆ„Éá„Éº„Çø„Å®‰∏ç‰∏ÄËá¥
- Áï∞Â∏∏„Å™È´òÈ°çÊ≥®Êñá
```

---

## üîç Ê§úÁü•„Ç¢„É´„Ç¥„É™„Ç∫„É†

### „É¨„Éô„É´1: „É™„Ç¢„É´„Çø„Ç§„É†„É´„Éº„É´„Éô„Éº„ÇπÊ§úÁü•

```php
class FraudDetectionService
{
    /**
     * „ÇØ„É™„ÉÉ„ÇØ‰∏çÊ≠£Ê§úÁü•
     */
    public function detectClickFraud($clickData)
    {
        $riskScore = 0;
        $flags = [];

        // 1. IP„É¨„Éî„É•„ÉÜ„Éº„Ç∑„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØ
        if ($this->isBlacklistedIP($clickData['ip'])) {
            $riskScore += 50;
            $flags[] = 'BLACKLISTED_IP';
        }

        // 2. Âêå‰∏ÄIPÂ§ßÈáè„ÇØ„É™„ÉÉ„ÇØÊ§úÁü•
        $recentClicks = $this->getRecentClicksByIP(
            $clickData['ip'],
            $clickData['campaign_id'],
            3600 // 1ÊôÇÈñì
        );

        if ($recentClicks > 10) {
            $riskScore += 30;
            $flags[] = 'EXCESSIVE_CLICKS_SAME_IP';
        }

        // 3. „Éú„ÉÉ„ÉàUAÊ§úÂá∫
        if ($this->isBotUserAgent($clickData['user_agent'])) {
            $riskScore += 40;
            $flags[] = 'BOT_USER_AGENT';
        }

        // 4. „Éá„Éê„Ç§„Çπ„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÈáçË§á
        $fpClicks = $this->getRecentClicksByFingerprint(
            $clickData['fingerprint'],
            $clickData['campaign_id'],
            3600
        );

        if ($fpClicks > 15) {
            $riskScore += 35;
            $flags[] = 'EXCESSIVE_CLICKS_SAME_DEVICE';
        }

        // 5. Referer„ÉÅ„Çß„ÉÉ„ÇØ
        if (empty($clickData['referer']) ||
            $this->isSuspiciousReferer($clickData['referer'])) {
            $riskScore += 20;
            $flags[] = 'SUSPICIOUS_REFERER';
        }

        // 6. Âú∞ÁêÜÁöÑÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
        $ipLocation = $this->getIPLocation($clickData['ip']);
        $targetGeo = $this->getCampaignTargeting($clickData['campaign_id'])['geo'];

        if (!in_array($ipLocation['country'], $targetGeo)) {
            $riskScore += 25;
            $flags[] = 'GEO_MISMATCH';
        }

        // 7. „ÇØ„É™„ÉÉ„ÇØÈÄüÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØÔºàÂêå‰∏Ä„Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàÔºâ
        $lastClick = $this->getLastClickByAffiliate(
            $clickData['affiliate_id'],
            $clickData['campaign_id']
        );

        if ($lastClick && (time() - $lastClick['timestamp']) < 5) {
            $riskScore += 30;
            $flags[] = 'RAPID_CLICKS';
        }

        return [
            'risk_score' => min($riskScore, 100),
            'flags' => $flags,
            'action' => $this->determineAction($riskScore)
        ];
    }

    /**
     * „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥‰∏çÊ≠£Ê§úÁü•
     */
    public function detectConversionFraud($conversionData)
    {
        $riskScore = 0;
        $flags = [];

        // 1. „Çª„É´„Éï„Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàÊ§úÁü•
        $click = $this->getClickByTrackingId($conversionData['tracking_id']);

        if ($this->isSelfAffiliate($click, $conversionData)) {
            $riskScore += 70;
            $flags[] = 'SELF_AFFILIATE';
        }

        // 2. „ÇØ„É™„ÉÉ„ÇØ‚Üí„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥ÊôÇÈñì„ÉÅ„Çß„ÉÉ„ÇØ
        $timeDiff = strtotime($conversionData['converted_at']) -
                    strtotime($click['clicked_at']);

        if ($timeDiff < 10) { // 10Áßí‰ª•ÂÜÖ
            $riskScore += 50;
            $flags[] = 'INSTANT_CONVERSION';
        }

        if ($timeDiff > 2592000) { // 30Êó•Ë∂ÖÈÅé
            $riskScore += 40;
            $flags[] = 'EXPIRED_CONVERSION_WINDOW';
        }

        // 3. Áï∞Â∏∏È´òÈ°çÊ≥®Êñá
        $avgOrderValue = $this->getAverageCampaignOrderValue(
            $conversionData['campaign_id']
        );

        if ($conversionData['order_amount'] > $avgOrderValue * 5) {
            $riskScore += 30;
            $flags[] = 'ABNORMAL_HIGH_ORDER';
        }

        // 4. È°ßÂÆ¢ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
        $duplicateOrders = $this->getDuplicateCustomerOrders(
            $conversionData['customer_email_hash'],
            $conversionData['affiliate_id'],
            30 // 30Êó•‰ª•ÂÜÖ
        );

        if ($duplicateOrders > 3) {
            $riskScore += 40;
            $flags[] = 'DUPLICATE_CUSTOMER';
        }

        // 5. Ê≥®ÊñáIDÈáçË§á
        if ($this->isOrderIdDuplicate($conversionData['order_id'])) {
            $riskScore += 90;
            $flags[] = 'DUPLICATE_ORDER_ID';
        }

        // 6. IP„Ç¢„Éâ„É¨„Çπ‰∏ÄËá¥ÁéáÔºà„ÇØ„É™„ÉÉ„ÇØ vs „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Ôºâ
        $conversionIP = $this->getConversionIP($conversionData);

        if ($click['ip_address'] !== $conversionIP) {
            $riskScore += 20;
            $flags[] = 'IP_MISMATCH';
        }

        // 7. „Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„ÉºËøîÈáëÂ±•Ê≠¥
        $refundRate = $this->getAffiliateRefundRate(
            $conversionData['affiliate_id'],
            90 // ÈÅéÂéª90Êó•
        );

        if ($refundRate > 0.3) { // 30%‰ª•‰∏ä
            $riskScore += 35;
            $flags[] = 'HIGH_REFUND_RATE';
        }

        return [
            'risk_score' => min($riskScore, 100),
            'flags' => $flags,
            'action' => $this->determineAction($riskScore)
        ];
    }

    /**
     * „É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢„Å´Âü∫„Å•„Åè„Ç¢„ÇØ„Ç∑„Éß„É≥Ê±∫ÂÆö
     */
    private function determineAction($riskScore)
    {
        if ($riskScore >= 80) {
            return 'BLOCK'; // Ëá™Âãï„Éñ„É≠„ÉÉ„ÇØ
        } elseif ($riskScore >= 60) {
            return 'MANUAL_REVIEW'; // ÊâãÂãï„É¨„Éì„É•„Éº
        } elseif ($riskScore >= 40) {
            return 'FLAG'; // „Éï„É©„Ç∞‰ªò„Åë
        } else {
            return 'APPROVE'; // ÊâøË™ç
        }
    }

    /**
     * „Çª„É´„Éï„Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàÂà§ÂÆö
     */
    private function isSelfAffiliate($click, $conversion)
    {
        // 1. IPÂÆåÂÖ®‰∏ÄËá¥
        if ($click['ip_address'] === $this->getConversionIP($conversion)) {
            return true;
        }

        // 2. „Éá„Éê„Ç§„Çπ„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„Éà‰∏ÄËá¥
        if ($click['fingerprint'] === $conversion['fingerprint']) {
            return true;
        }

        // 3. „Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„ÉºÊÉÖÂ†±„Å®Ë≥ºÂÖ•ËÄÖÊÉÖÂ†±„ÅÆ‰∏ÄËá¥
        $affiliate = $this->getAffiliate($click['affiliate_id']);
        $customerHash = $conversion['customer_email_hash'];

        if (hash('sha256', $affiliate['email']) === $customerHash) {
            return true;
        }

        return false;
    }
}
```

---

### „É¨„Éô„É´2: „Éô„É≠„Ç∑„ÉÜ„Ç£„É´„Éº„É´ÔºàÈÄüÂ∫¶Âà∂ÈôêÔºâ

```php
class VelocityRuleEngine
{
    /**
     * Áï∞Â∏∏„Å™„ÇØ„É™„ÉÉ„ÇØÈÄüÂ∫¶Ê§úÁü•
     */
    public function checkClickVelocity($affiliateId, $campaignId)
    {
        $windows = [
            '1min' => 60,
            '5min' => 300,
            '1hour' => 3600,
            '1day' => 86400
        ];

        $thresholds = [
            '1min' => 5,
            '5min' => 20,
            '1hour' => 100,
            '1day' => 500
        ];

        foreach ($windows as $name => $seconds) {
            $count = $this->getClickCount($affiliateId, $campaignId, $seconds);

            if ($count > $thresholds[$name]) {
                return [
                    'exceeded' => true,
                    'window' => $name,
                    'count' => $count,
                    'threshold' => $thresholds[$name],
                    'action' => 'RATE_LIMIT'
                ];
            }
        }

        return ['exceeded' => false];
    }

    /**
     * Áï∞Â∏∏„Å™„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥ÈÄüÂ∫¶Ê§úÁü•
     */
    public function checkConversionVelocity($affiliateId)
    {
        // ÈÄöÂ∏∏„Å®„ÅØÁï∞„Å™„ÇãÊÄ•ÊøÄ„Å™„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Â¢óÂä†„ÇíÊ§úÁü•
        $currentRate = $this->getConversionRate($affiliateId, 3600); // 1ÊôÇÈñì
        $historicalRate = $this->getHistoricalConversionRate($affiliateId, 30); // 30Êó•Âπ≥Âùá

        if ($currentRate > $historicalRate * 10) {
            return [
                'anomaly' => true,
                'current_rate' => $currentRate,
                'historical_rate' => $historicalRate,
                'multiplier' => $currentRate / $historicalRate
            ];
        }

        return ['anomaly' => false];
    }
}
```

---

### „É¨„Éô„É´3: „Ç∞„É©„ÉïÂàÜÊûêÔºà„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰∏çÊ≠£Ê§úÁü•Ôºâ

```php
class FraudNetworkDetector
{
    /**
     * ‰∏çÊ≠£„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊ§úÁü•
     * Ë§áÊï∞„ÅÆ„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„Éº„ÅåÂçîÂäõ„Åó„Å¶‰∏çÊ≠£„ÇíË°å„ÅÜ„Éë„Çø„Éº„É≥„ÇíÊ§úÁü•
     */
    public function detectFraudNetwork()
    {
        // 1. Áñë„Çè„Åó„ÅÑ„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„Éº„Ç∞„É´„Éº„Éó„ÇíÁâπÂÆö
        $suspiciousGroups = $this->findSuspiciousGroups();

        foreach ($suspiciousGroups as $group) {
            // 2. „Ç∞„É©„ÉïÊßãÈÄ†„ÇíÊßãÁØâ
            $graph = $this->buildNetworkGraph($group['affiliates']);

            // 3. ÂÖ±ÈÄö„Éë„Çø„Éº„É≥ÂàÜÊûê
            $commonPatterns = [
                'shared_ips' => $this->findSharedIPs($graph),
                'shared_devices' => $this->findSharedDevices($graph),
                'coordinated_timing' => $this->detectCoordinatedActivity($graph),
                'circular_referrals' => $this->detectCircularReferrals($graph)
            ];

            // 4. „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢Ë®àÁÆó
            $networkRiskScore = $this->calculateNetworkRisk($commonPatterns);

            if ($networkRiskScore > 70) {
                $this->flagFraudNetwork($group['affiliates'], $commonPatterns);
            }
        }
    }

    /**
     * Áñë„Çè„Åó„ÅÑ„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„Éº„Ç∞„É´„Éº„ÉóÁâπÂÆö
     */
    private function findSuspiciousGroups()
    {
        // Âêå‰∏ÄIP„Åã„ÇâË§áÊï∞„Ç¢„Ç´„Ç¶„É≥„ÉàÁôªÈå≤
        $ipGroups = DB::table('users')
            ->select('last_login_ip', DB::raw('COUNT(*) as count'))
            ->where('user_type', 'affiliate')
            ->groupBy('last_login_ip')
            ->having('count', '>=', 3)
            ->get();

        // Áü≠ÊúüÈñì„Åß„ÅÆÂ§ßÈáèÁ¥π‰ªã
        $referralGroups = DB::table('users')
            ->select('referrer_id', DB::raw('COUNT(*) as count'))
            ->where('created_at', '>=', now()->subDays(7))
            ->groupBy('referrer_id')
            ->having('count', '>=', 10)
            ->get();

        return array_merge($ipGroups, $referralGroups);
    }

    /**
     * Âæ™Áí∞Á¥π‰ªãÊ§úÁü•ÔºàA‚ÜíB‚ÜíC‚ÜíAÔºâ
     */
    private function detectCircularReferrals($graph)
    {
        $visited = [];
        $cycles = [];

        foreach ($graph as $node => $edges) {
            $path = [$node];
            $current = $node;

            while (isset($graph[$current]['referrer'])) {
                $referrer = $graph[$current]['referrer'];

                if (in_array($referrer, $path)) {
                    // Âæ™Áí∞Áô∫Ë¶ã
                    $cycles[] = array_merge(
                        array_slice($path, array_search($referrer, $path)),
                        [$referrer]
                    );
                    break;
                }

                $path[] = $referrer;
                $current = $referrer;
            }
        }

        return $cycles;
    }
}
```

---

## ü§ñ Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´

### „É¢„Éá„É´1: „É©„É≥„ÉÄ„É†„Éï„Ç©„É¨„Çπ„ÉàÔºà„ÇØ„É™„ÉÉ„ÇØ‰∏çÊ≠£ÂàÜÈ°ûÔºâ

```python
import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report

class ClickFraudMLModel:
    def __init__(self):
        self.model = RandomForestClassifier(
            n_estimators=100,
            max_depth=10,
            random_state=42
        )

    def prepare_features(self, click_data):
        """ÁâπÂæ¥Èáè„Ç®„É≥„Ç∏„Éã„Ç¢„É™„É≥„Ç∞"""
        features = pd.DataFrame({
            # ÊôÇÈñìÁâπÂæ¥
            'hour_of_day': click_data['clicked_at'].dt.hour,
            'day_of_week': click_data['clicked_at'].dt.dayofweek,

            # „ÇØ„É™„ÉÉ„ÇØÈñìÈöî
            'time_since_last_click': click_data.groupby('affiliate_id')['clicked_at'].diff().dt.total_seconds(),

            # IP„Éô„Éº„ÇπÁâπÂæ¥
            'ip_click_count_1h': self.get_ip_click_count(click_data, window='1H'),
            'ip_click_count_24h': self.get_ip_click_count(click_data, window='24H'),

            # „Éá„Éê„Ç§„ÇπÁâπÂæ¥
            'device_type_encoded': pd.get_dummies(click_data['device_type']),
            'is_mobile': (click_data['device_type'] == 'mobile').astype(int),

            # „Éñ„É©„Ç¶„Ç∂ÁâπÂæ¥
            'browser_version': click_data['browser'].str.extract(r'(\d+)')[0].astype(float),
            'is_bot_ua': click_data['user_agent'].str.contains('bot|crawler|spider', case=False).astype(int),

            # Âú∞ÁêÜÁöÑÁâπÂæ¥
            'country_risk_score': click_data['country_code'].map(self.country_risk_scores),
            'geo_velocity': self.calculate_geo_velocity(click_data),

            # „Ç¢„Éï„Ç£„É™„Ç®„Ç§„Çø„ÉºÁâπÂæ¥
            'affiliate_age_days': (pd.Timestamp.now() - click_data['affiliate_created_at']).dt.days,
            'affiliate_click_count_total': click_data.groupby('affiliate_id').cumcount(),
            'affiliate_fraud_history': click_data['affiliate_id'].map(self.fraud_history),

            # „Ç≠„É£„É≥„Éö„Éº„É≥ÁâπÂæ¥
            'campaign_avg_cvr': click_data['campaign_id'].map(self.campaign_cvr),
            'commission_value': click_data['commission_value'],

            # RefererÁâπÂæ¥
            'has_referer': (~click_data['referer'].isna()).astype(int),
            'referer_domain': click_data['referer'].str.extract(r'https?://([^/]+)')[0],

            # „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÁâπÂæ¥
            'fp_click_count_1h': self.get_fp_click_count(click_data, window='1H'),
        })

        return features

    def train(self, X_train, y_train):
        """„É¢„Éá„É´Ë®ìÁ∑¥"""
        self.model.fit(X_train, y_train)

        # ÁâπÂæ¥ÈáèÈáçË¶ÅÂ∫¶
        feature_importance = pd.DataFrame({
            'feature': X_train.columns,
            'importance': self.model.feature_importances_
        }).sort_values('importance', ascending=False)

        print("Top 10 Important Features:")
        print(feature_importance.head(10))

        return self.model

    def predict_fraud_probability(self, click_data):
        """‰∏çÊ≠£Á¢∫Áéá‰∫àÊ∏¨"""
        features = self.prepare_features(click_data)
        probabilities = self.model.predict_proba(features)[:, 1]  # ‰∏çÊ≠£„ÇØ„É©„Çπ„ÅÆÁ¢∫Áéá

        return pd.DataFrame({
            'click_id': click_data['id'],
            'fraud_probability': probabilities,
            'fraud_score': (probabilities * 100).astype(int),
            'predicted_label': (probabilities > 0.5).astype(int)
        })
```

---

### „É¢„Éá„É´2: Isolation ForestÔºàÁï∞Â∏∏Ê§úÁü•Ôºâ

```python
from sklearn.ensemble import IsolationForest

class AnomalyDetector:
    def __init__(self):
        self.model = IsolationForest(
            contamination=0.1,  # 10%„ÅåÁï∞Â∏∏„Å®‰ªÆÂÆö
            random_state=42
        )

    def detect_anomalies(self, conversion_data):
        """Áï∞Â∏∏„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Ê§úÁü•"""
        features = pd.DataFrame({
            'order_amount': conversion_data['order_amount'],
            'commission_amount': conversion_data['commission_amount'],
            'time_to_conversion': conversion_data['time_to_conversion_seconds'],
            'customer_lifetime_orders': conversion_data['customer_order_count'],
            'affiliate_cvr': conversion_data['affiliate_conversion_rate'],
            'device_switches': conversion_data['device_change_count']
        })

        # Ê®ôÊ∫ñÂåñ
        from sklearn.preprocessing import StandardScaler
        scaler = StandardScaler()
        features_scaled = scaler.fit_transform(features)

        # Áï∞Â∏∏„Çπ„Ç≥„Ç¢Ë®àÁÆó
        anomaly_scores = self.model.fit_predict(features_scaled)
        anomaly_probs = self.model.score_samples(features_scaled)

        return pd.DataFrame({
            'conversion_id': conversion_data['id'],
            'is_anomaly': (anomaly_scores == -1).astype(int),
            'anomaly_score': anomaly_probs,
            'anomaly_rank': pd.Series(anomaly_probs).rank(ascending=True)
        })
```

---

### „É¢„Éá„É´3: LSTMÔºàÊôÇÁ≥ªÂàóÁï∞Â∏∏Ê§úÁü•Ôºâ

```python
import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense, Dropout

class TimeSeriesAnomalyDetector:
    def __init__(self, sequence_length=24):
        self.sequence_length = sequence_length
        self.model = self.build_model()

    def build_model(self):
        """LSTM „Ç™„Éº„Éà„Ç®„É≥„Ç≥„Éº„ÉÄ„ÉºÊßãÁØâ"""
        model = Sequential([
            LSTM(64, activation='relu', input_shape=(self.sequence_length, 1), return_sequences=True),
            Dropout(0.2),
            LSTM(32, activation='relu', return_sequences=False),
            Dropout(0.2),
            Dense(32, activation='relu'),
            Dense(64, activation='relu'),
            Dense(self.sequence_length)
        ])

        model.compile(optimizer='adam', loss='mse')
        return model

    def detect_traffic_anomaly(self, hourly_click_data):
        """ÊôÇÁ≥ªÂàó„Éà„É©„Éï„Ç£„ÉÉ„ÇØÁï∞Â∏∏Ê§úÁü•"""
        # ÈÅéÂéª24ÊôÇÈñì„ÅÆ„ÇØ„É™„ÉÉ„ÇØÊï∞„Çí‰ΩøÁî®
        sequences = self.create_sequences(hourly_click_data, self.sequence_length)

        # Ê≠£Â∏∏„Éá„Éº„Çø„ÅßË®ìÁ∑¥
        normal_data = sequences[sequences['is_fraud'] == 0]
        self.model.fit(
            normal_data['sequence'],
            normal_data['sequence'],
            epochs=50,
            batch_size=32,
            validation_split=0.2,
            verbose=0
        )

        # ÂÜçÊßãÊàê„Ç®„É©„Éº„ÅßÁï∞Â∏∏Ê§úÁü•
        reconstructions = self.model.predict(sequences['sequence'])
        reconstruction_errors = np.mean(np.abs(sequences['sequence'] - reconstructions), axis=1)

        # ÈñæÂÄ§Ë®≠ÂÆöÔºàÊ≠£Â∏∏„Éá„Éº„Çø„ÅÆ99„Éë„Éº„Çª„É≥„Çø„Ç§„É´Ôºâ
        threshold = np.percentile(reconstruction_errors, 99)

        return pd.DataFrame({
            'timestamp': sequences['timestamp'],
            'reconstruction_error': reconstruction_errors,
            'is_anomaly': (reconstruction_errors > threshold).astype(int),
            'anomaly_severity': (reconstruction_errors / threshold * 100).clip(0, 100)
        })
```

---

## üõ° ÂÆüË£Ö„Ç≥„Éº„Éâ‰æã

### „É™„Ç¢„É´„Çø„Ç§„É†‰∏çÊ≠£Ê§úÁü•„Éë„Ç§„Éó„É©„Ç§„É≥

```php
// app/Services/FraudDetection/FraudDetectionPipeline.php

class FraudDetectionPipeline
{
    private $detectors = [];

    public function __construct()
    {
        // Ê§úÁü•Âô®„ÇíÂÑ™ÂÖàÂ∫¶È†Ü„Å´ÁôªÈå≤
        $this->registerDetector(new BlacklistDetector(), 1);
        $this->registerDetector(new RuleBasedDetector(), 2);
        $this->registerDetector(new VelocityDetector(), 3);
        $this->registerDetector(new MLDetector(), 4);
        $this->registerDetector(new NetworkDetector(), 5);
    }

    /**
     * „ÇØ„É™„ÉÉ„ÇØÊ§úË®º„Éë„Ç§„Éó„É©„Ç§„É≥ÂÆüË°å
     */
    public function validateClick($clickData)
    {
        $results = [];
        $totalRiskScore = 0;

        foreach ($this->detectors as $detector) {
            $result = $detector->analyze($clickData);

            $results[$detector->getName()] = $result;
            $totalRiskScore += $result['risk_score'] * $detector->getWeight();

            // Âç≥Â∫ß„Å´„Éñ„É≠„ÉÉ„ÇØ„Åô„Åπ„Åç„É¨„Éô„É´„ÅÆ‰∏çÊ≠£Ê§úÁü•
            if ($result['action'] === 'BLOCK') {
                $this->logFraudDetection($clickData, $results, 'BLOCKED');
                throw new FraudDetectedException('„ÇØ„É™„ÉÉ„ÇØ„Åå‰∏çÊ≠£„Å®Âà§ÂÆö„Åï„Çå„Åæ„Åó„Åü');
            }
        }

        // Á∑èÂêàÂà§ÂÆö
        $finalAction = $this->determineFinalAction($totalRiskScore);

        // „É≠„Ç∞Ë®òÈå≤
        $this->saveFraudLog([
            'entity_type' => 'click',
            'entity_id' => $clickData['id'],
            'risk_score' => $totalRiskScore,
            'detection_results' => $results,
            'action' => $finalAction
        ]);

        return [
            'allowed' => $finalAction !== 'BLOCK',
            'risk_score' => $totalRiskScore,
            'action' => $finalAction,
            'flags' => $this->aggregateFlags($results)
        ];
    }

    /**
     * ÈùûÂêåÊúü„Åß„ÅÆË©≥Á¥∞ÂàÜÊûê
     */
    public function queueDetailedAnalysis($clickData)
    {
        // Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„ÇÑÈáç„ÅÑÂá¶ÁêÜ„ÅØÈùûÂêåÊúüÂÆüË°å
        dispatch(new AnalyzeClickFraudJob($clickData));
    }
}
```

---

### „Éá„Éê„Ç§„Çπ„Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„ÉàÁîüÊàê

```javascript
// resources/js/fraud-detection/fingerprint.js

class DeviceFingerprint {
    async generate() {
        const components = {
            // „Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±
            userAgent: navigator.userAgent,
            language: navigator.language,
            platform: navigator.platform,
            hardwareConcurrency: navigator.hardwareConcurrency,
            deviceMemory: navigator.deviceMemory,

            // „Çπ„ÇØ„É™„Éº„É≥ÊÉÖÂ†±
            screenResolution: `${screen.width}x${screen.height}`,
            colorDepth: screen.colorDepth,
            pixelRatio: window.devicePixelRatio,

            // „Çø„Ç§„É†„Çæ„Éº„É≥
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            timezoneOffset: new Date().getTimezoneOffset(),

            // Canvas „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„Éà
            canvas: await this.getCanvasFingerprint(),

            // WebGL „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„Éà
            webgl: await this.getWebGLFingerprint(),

            // „Ç™„Éº„Éá„Ç£„Ç™ „Éï„Ç£„É≥„Ç¨„Éº„Éó„É™„É≥„Éà
            audio: await this.getAudioFingerprint(),

            // „Éï„Ç©„É≥„ÉàÊ§úÂá∫
            fonts: await this.detectFonts(),

            // „Éó„É©„Ç∞„Ç§„É≥
            plugins: this.getPlugins(),

            // „Çø„ÉÉ„ÉÅ„Çµ„Éù„Éº„Éà
            touchSupport: 'ontouchstart' in window,

            // „Éê„ÉÉ„ÉÜ„É™„ÉºÊÉÖÂ†±ÔºàÂà©Áî®ÂèØËÉΩ„Å™Â†¥ÂêàÔºâ
            battery: await this.getBatteryInfo()
        };

        // SHA-256 „Éè„ÉÉ„Ç∑„É•ÁîüÊàê
        const fingerprint = await this.hash(JSON.stringify(components));

        return {
            fingerprint: fingerprint,
            components: components
        };
    }

    async getCanvasFingerprint() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.textBaseline = 'alphabetic';
        ctx.fillStyle = '#f60';
        ctx.fillRect(125, 1, 62, 20);
        ctx.fillStyle = '#069';
        ctx.fillText('FingerprintJS', 2, 15);
        ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
        ctx.fillText('FingerprintJS', 4, 17);

        return canvas.toDataURL();
    }

    async hash(text) {
        const encoder = new TextEncoder();
        const data = encoder.encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
}

// ‰ΩøÁî®‰æã
const fp = new DeviceFingerprint();
const result = await fp.generate();
console.log('Fingerprint:', result.fingerprint);
```

---

## üìä ÈÅãÁî®„É´„Éº„É´

### Ëá™ÂãïÂØæÂøú„Éï„É≠„Éº

```
„É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢ 0-39ÁÇπ
‚îî‚Üí Ëá™ÂãïÊâøË™ç
   ‚îú‚Üí ÈÄöÂ∏∏Âá¶ÁêÜ
   ‚îî‚Üí „É≠„Ç∞Ë®òÈå≤„ÅÆ„Åø

„É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢ 40-59ÁÇπ
‚îî‚Üí „Éï„É©„Ç∞‰ªò„Åë
   ‚îú‚Üí ÊâøË™çÔºàÊù°‰ª∂‰ªò„ÅçÔºâ
   ‚îú‚Üí Áõ£Ë¶ñ„É™„Çπ„ÉàËøΩÂä†
   ‚îî‚Üí ÈÄ±Ê¨°„É¨„Éì„É•„ÉºÂØæË±°

„É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢ 60-79ÁÇπ
‚îî‚Üí ÊâãÂãï„É¨„Éì„É•„ÉºÂøÖÈ†à
   ‚îú‚Üí ‰øùÁïôÁä∂ÊÖã
   ‚îú‚Üí ÁÆ°ÁêÜËÄÖÈÄöÁü•
   ‚îî‚Üí 24ÊôÇÈñì‰ª•ÂÜÖ„Å´„É¨„Éì„É•„Éº

„É™„Çπ„ÇØ„Çπ„Ç≥„Ç¢ 80-100ÁÇπ
‚îî‚Üí Ëá™Âãï„Éñ„É≠„ÉÉ„ÇØ
   ‚îú‚Üí Âç≥Â∫ß„Å´ÊãíÂê¶
   ‚îú‚Üí „Ç¢„Ç´„Ç¶„É≥„Éà‰∏ÄÊôÇÂÅúÊ≠¢
   ‚îî‚Üí „Ç¢„É©„Éº„ÉàÈÄÅ‰ø°
```

### ÊÆµÈöéÁöÑÂà∂Ë£ÅÊé™ÁΩÆ

```php
class FraudPenaltySystem
{
    public function applyPenalty($affiliateId, $fraudSeverity)
    {
        $history = $this->getFraudHistory($affiliateId);

        switch ($fraudSeverity) {
            case 'LOW':
                if ($history['low_count'] >= 3) {
                    $this->issueWarning($affiliateId);
                }
                break;

            case 'MEDIUM':
                if ($history['medium_count'] >= 2) {
                    $this->suspendAccount($affiliateId, days: 7);
                } else {
                    $this->reduceCommission($affiliateId, percentage: 50);
                }
                break;

            case 'HIGH':
                $this->permanentBan($affiliateId);
                $this->blacklistRelatedAccounts($affiliateId);
                break;
        }
    }
}
```

---

„Åì„ÅÆ‰∏çÊ≠£Ê§úÁü•„Ç∑„Çπ„ÉÜ„É†„Å´„Çà„Çä„ÄÅ„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Éà‰∏çÊ≠£„ÇíÂ§öÂ±§ÁöÑ„Å´Èò≤Âæ°„Åß„Åç„Åæ„Åô„ÄÇ
